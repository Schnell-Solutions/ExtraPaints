{% extends "base.html" %}

{% block title %}Our Portfolio{% endblock %}

{% block content %}
<section class="py-12 lg:px-12 md:py-16 bg-neutral-50 min-h-[1000px]">
  <div class="container mx-auto px-4">

    <div class="text-center mb-12">
      <h1 class="text-3xl md:text-4xl font-bold text-primary-900 mb-2">
        Our Portfolio
      </h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        See how our products have transformed spaces, from cozy homes to large-scale commercial properties.
      </p>
    </div>

    <div class="mb-8 flex justify-center">
      <form method="get" class="flex flex-wrap gap-4 items-center">
        {% csrf_token %} <label for="type-filter" class="text-sm font-medium text-gray-700">Filter by type:</label>

        <div class="relative filter-select-wrapper">
          <select
            name="type"
            id="type-filter"
            class="pl-4 pr-10 py-2 border rounded text-sm text-primary-900 bg-white focus:outline-none focus:border-primary-500 appearance-none"
            onchange="this.form.submit()"
          >
            <option value="">All Project Types</option>
            {% for value, display_name in project.PROJECT_TYPES %}
              {% if value in project_types %}
                <option value="{{ value }}" {% if value == selected_type %}selected{% endif %}>
                  {{ display_name }}
                </option>
              {% endif %}
            {% endfor %}
          </select>
          <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
            <svg class="w-5 h-5 text-primary-900 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 8l4 4 4-4"/>
            </svg>
          </div>
        </div>

        {% if selected_type %}
          <a href="{% url 'portfolio_list' %}" class="px-4 py-2 border border-primary-900 text-primary-900 rounded text-sm font-medium hover:bg-primary-900 hover:text-white transition-colors">
            Clear
          </a>
        {% endif %}
      </form>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {% for project in projects %}
        <a href="{{ project.get_absolute_url }}" class="group block bg-white rounded border border-neutral-200 overflow-hidden transition-all duration-300 hover:shadow flex flex-col">
          <div class="h-60 w-full overflow-hidden">
              {% if project.get_display_image %}
                  <img src="{{ project.get_display_image }}" alt="{{ project.title }}" class="w-full h-full object-cover">
              {% else %}
                  <img src="{{ MEDIA_URL }}default.jpg" alt="{{ project.title }}" class="w-full h-full object-cover">
              {% endif %}
          </div>

          <div class="p-5 flex flex-col flex-grow">
            <span class="text-xs font-semibold uppercase tracking-wider text-primary-700 bg-primary-50 px-2 py-0.5 rounded">
              {{ project.get_project_type_display }}
            </span>
            <h3 class="text-xl font-semibold text-primary-900 mt-3 mb-2">
              {{ project.title }}
            </h3>
            <p class="text-sm text-gray-600 mt-auto pt-4">
              {{ project.location|default:"Location not specified" }}
            </p>
          </div>
        </a>
      {% empty %}
        {# --- Empty State Logic for Portfolio --- #}
        {% if projects|length == 0 and not selected_type %}
          {# No projects in the database (initial state) #}
          <div class="col-span-full py-12 flex justify-center items-center h-full">
            <div id="portfolio-empty-state-initial" class="text-center py-8 px-12 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 max-w-lg mx-auto">
              <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 mx-auto text-gray-400 mb-3 lucide lucide-gallery-horizontal-end"><path d="M7 2h13a2 2 0 0 1 2 2v13"/><path d="M17 17V7H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3"/></svg>
              <h3 class="text-xl font-semibold text-primary-900 mb-2">Portfolio Under Development</h3>
              <p class="text-gray-600">
                We're currently gathering images of our latest projects. Please check back soon to see our work!
              </p>
            </div>
          </div>
        {% else %}
          {# No results found due to filter criteria #}
          <div class="col-span-full py-12">
            <div id="portfolio-empty-state-filter" class="text-center py-8 px-12 border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 max-w-xl mx-auto">
              <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 mx-auto text-gray-400 mb-3 lucide lucide-list-x"><path d="M11 12H3"/><path d="M16 6H3"/><path d="M16 18H3"/><path d="m19 10-2 2 2 2"/><path d="m19 14-2-2 2-2"/></svg>
              <h3 class="text-xl font-semibold text-primary-900 mb-2">No Projects Found</h3>
              <p class="text-gray-600">
                There are no completed projects in the selected category (**{{ selected_type|default:'-' }}**).
                Try selecting **All Project Types** to see the full list.
              </p>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- ANIMATE SELECT ARROWS ---
  document.querySelectorAll('.filter-select-wrapper').forEach(wrapper => {
    const select = wrapper.querySelector('select');
    const svg = wrapper.querySelector('svg');

    if (select && svg) {
      select.addEventListener('focus', () => {
        svg.classList.add('rotate-180');
      });
      select.addEventListener('blur', () => {
        svg.classList.remove('rotate-180');
      });
    }
  });
});
</script>
{% endblock %}